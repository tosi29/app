# UI仕様書 - 配信管理アプリケーション

## 概要

本アプリケーションは、過去の配信の管理、検索、およびリスナーコメントの可視化を提供するWebアプリケーションです。タブベースのインターフェースを提供し、3つの主要機能を持ちます。

## 技術スタック

### 使用技術

- **フレームワーク**: Next.js 15.2.4
- **言語**: TypeScript 5.8.3
- **UIライブラリ**: React 18.2.0
- **スタイリング**: CSS Modules
- **開発ツール**: ESLint 8.56.0

### アーキテクチャ

- **ページ構成**: Single Page Application（SPA）形式
- **ルーティング**: Next.js Router（クライアントサイド）
- **API**: Next.js API Routes
- **状態管理**: React Hooks（useState, useEffect）

## 全体構成

### レイアウト構造

- タブナビゲーション（Tabsコンポーネント）
- メインコンテンツエリア（動的切り替え）
- レスポンシブデザイン対応

### タブ構成

1. **配信一覧** (`broadcasts`) - 過去の配信一覧表示
2. **配信検索** (`search`) - キーワード・シリーズ検索
3. **コメント** (`comments`) - コメント可視化（散布図）

## 1. 配信一覧タブ

### 機能概要

シリーズ別にグループ化された過去の配信一覧を表示。各シリーズは展開/折りたたみ可能で、アルファベット順に表示されます。

### テーブル構成

| カラム | 内容 |
|--------|------|
| 日付 | YYYY-MM-DD形式 |
| タイトル | エピソードタイトル |
| 再生時間 | MM:SS形式 |
| リンク | 再生・コメント表示ボタン |

### インタラクション機能

#### シリーズ展開/折りたたみ
- シリーズヘッダーをクリックで展開/折りたたみ
- 初期状態：全シリーズ展開済み
- トグルアイコン（▼/▶）で状態表示

#### アクションボタン
- **再生ボタン**: 配信URLへ新しいタブで遷移
- **コメントボタン**: コメントタブへ遷移（`/?tab=comments&episodeId=${id}`）

### データ読み込み状態
- ローディング中："配信データを読み込み中..."表示

## 2. 配信検索タブ

### 機能概要

キーワードおよびシリーズフィルターによる配信検索機能を提供します。

### フォーム構成

#### 検索フィールド
- **検索キーワード入力**: タイトル・概要でのテキスト検索
- **シリーズ選択**: ドロップダウンでシリーズフィルタリング
  - オプション：すべて、Basic Series、Guest Series、Community Series

#### 検索ボタン
- 通常状態："検索"
- ローディング状態："検索中..." + ボタン無効化

### 検索結果表示

各検索結果には以下の情報を表示：
- エピソードタイトル
- シリーズ名
- エピソード概要
- アクションボタン（再生・コメント表示）

### 状態管理
- 検索実行前：フォームのみ表示
- 検索結果なし："該当する配信はありません。"メッセージ表示
- ローディング中：検索中表示

## 3. コメントタブ

### 機能概要

リスナーコメントの2次元散布図による可視化を提供します。X軸は「意見度」、Y軸は「ポジティブ度」を表現します。

### グラフ仕様

#### 座標系
- **2次元散布図**: 600x600px（デスクトップ）、450x450px（モバイル）
- **X軸**: 意見度（0-1、リアクション→意見）
- **Y軸**: ポジティブ度（0-1、ネガティブ→ポジティブ）

#### データポイント表示
- コメントを散布図上の点として表示
- シリーズ別の色分け表示
- ホバー・クリックでのインタラクション機能

### インタラクション機能

#### マウスインタラクション
- **ホバー**: ツールチップ表示、ドットサイズ拡大
- **クリック**: 詳細ツールチップ固定表示、フィードバックボタン表示

#### ツールチップ
- **基本表示**: エピソード番号、コメントテキスト、投稿者名
- **詳細表示**: 上記 + フィードバックボタン（👍役に立つ、❤️共感できる、🎯的を射ている）

### エピソード選択機能
- ドロップダウンでエピソード切り替え
- URLパラメータでの直接指定対応（`episodeId`）

### 表示状態
- **全エピソード**: すべてのコメントを表示、シリーズ別凡例表示
- **特定エピソード**: 選択エピソードのコメントのみ表示

## データ構造

### 配信データ（PastBroadcast）

```typescript
interface PastBroadcast {
  id: number;
  date: string;              // YYYY-MM-DD形式
  title: string;             // エピソードタイトル
  excerpt: string;           // 概要テキスト
  series: string;            // シリーズ名
  duration: string;          // MM:SS形式
  url: string;               // 配信URL
  youtube_video_id: string;  // YouTube動画ID
  spotify_episode_id: string; // SpotifyエピソードID
}
```

### コメントデータ（Comment）

```typescript
interface Comment {
  id: number;
  episodeId: number;
  text: string;           // コメント本文
  author: string;         // ユーザー名
  positiveScore: number;  // 0-1の値（ポジティブ度合い）
  opinionScore: number;   // 0-1の値（意見度合い）
}
```

## API仕様

### エンドポイント

- **GET /api/broadcasts**: 全配信データ取得
- **GET /api/search-broadcasts**: 検索機能
  - クエリパラメータ：`query`（検索キーワード）、`series`（シリーズフィルター）
- **GET /api/comments**: コメントデータ取得
  - クエリパラメータ：`episodeId`（特定エピソード指定）

## URLルーティング

### パラメーター仕様

- **タブ切り替え**: `/?tab={tabId}`
  - `tab=broadcasts`: 配信一覧タブ
  - `tab=search`: 検索タブ  
  - `tab=comments`: コメントタブ

- **エピソード指定**: `/?tab=comments&episodeId={id}`
  - 特定エピソードのコメント表示

### ナビゲーション動作

- **Shallow routing**: ページリロードなしでURL更新
- `router.replace()` を使用してブラウザ履歴の最適化
- ブラウザの戻る/進むボタンに対応

## ローディング・エラー状態

### ローディング表示
- 配信一覧："配信データを読み込み中..."
- コメント："コメントを読み込んでいます..."  
- 検索："検索中..."

### エラーハンドリング
- API呼び出し失敗時はコンソールエラーログ出力
- 検索結果なし時："該当する配信はありません。"表示

---

*この仕様書は現在のソースコードベース（2025年5月）に基づいて作成されています。*