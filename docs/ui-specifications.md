# UI仕様書 - 配信管理アプリケーション

## 概要

本アプリケーションは、過去の配信の管理、検索、およびリスナーコメントの可視化を提供するWebアプリケーションです。Next.jsを使用して開発されており、3つの主要なセクションを持つタブベースのインターフェースを提供します。

## 全体構成

### レイアウト構造

- **コンテナ**: 最大幅1000pxの中央配置レイアウト
- **タブナビゲーション**: 上部に配置された水平タブバー
- **メインコンテンツエリア**: タブの下に表示される動的コンテンツ領域

### カラーパレット

| 要素 | カラーコード | 用途 |
|------|-------------|------|
| プライマリー | `#3b82f6` | リンク、アクティブ要素 |
| セカンダリー | `#6366f1` | アクセント色 |
| 背景色 | `#fafafa` | ページ背景 |
| カード背景 | `#ffffff` | コンテンツ背景 |
| テキスト（主） | `#333333` | メインテキスト |
| テキスト（副） | `#666666` | サブテキスト |
| ボーダー | `#e5e7eb` | 境界線 |

### フォント設定

- **フォントファミリー**: システムフォント（ui-sans-serif, system-ui, etc.）
- **行間**: 1.6
- **基本フォントサイズ**: ブラウザデフォルト

## タブナビゲーション

### デザイン仕様

- **タブボタン**:
  - パディング: 0.75rem 1.5rem
  - フォントサイズ: 1rem
  - フォントウェイト: 500（通常）、600（アクティブ）
  - 非アクティブ色: `var(--text-secondary)`
  - アクティブ色: `var(--primary-color)`

### インタラクション

- **ホバー効果**: 
  - テキスト色が`var(--primary-color)`に変化
  - 下部にアンダーラインアニメーション（50%幅）
- **アクティブ状態**:
  - 下部に青色のアンダーライン（100%幅）
  - アニメーション付きトランジション（0.3秒）

### タブ構成

1. **配信一覧** (`broadcasts`)
2. **配信検索** (`search`) 
3. **コメント** (`comments`)

## 1. 配信一覧タブ

### 機能概要

シリーズ別にグループ化された過去の配信一覧を表示。各シリーズは展開/折りたたみ可能。シリーズはアルファベット順に表示。

### レイアウト構造

#### テーブル仕様

| カラム | 幅設定 | 内容 |
|--------|--------|------|
| 日付 | 自動 | YYYY-MM-DD形式 |
| タイトル | 拡張 | エピソードタイトル |
| 再生時間 | 自動 | MM:SS形式 |
| リンク | 自動 | 操作ボタン（再生・コメント表示） |

#### シリーズグループ表示

- **Basic Series**: 
  - 背景色: `rgba(144, 238, 144, 0.1)` (薄緑)
  - 左ボーダー: 3px、`rgba(144, 238, 144, 0.7)`

- **Guest Series**:
  - 背景色: `rgba(173, 216, 230, 0.1)` (薄青)
  - 左ボーダー: 3px、`rgba(173, 216, 230, 0.7)`

- **Community Series**:
  - 背景色: `rgba(255, 182, 193, 0.1)` (薄ピンク)
  - 左ボーダー: 3px、`rgba(255, 182, 193, 0.7)`

### インタラクション要素

#### 展開/折りたたみ機能

- **トグルアイコン**: 16x16px、回転アニメーション
- **シリーズヘッダー**: クリック可能、ホバー時に背景色変化
- **初期状態**: すべてのシリーズが展開済み

#### アクションボタン

- **再生ボタン**: 
  - プライマリーカラーのリンクスタイル
  - クリック時に配信URLへ遷移（新しいタブで開く）
  - `target="_blank" rel="noopener noreferrer"` 属性付き

- **コメントボタン**: 
  - クリック時に`/?tab=comments&episodeId=${id}`に遷移
  - コメントアイコン（💬）付きスタイル
  - テキスト: "コメントを見る"

### 状態表示

- **データ読み込み中**: 
  - "配信データを読み込み中..." というメッセージ
  - 中央配置
  - データ取得完了まで表示

### スタイリング詳細

- **テーブル境界**: 角丸（`var(--border-radius)`）
- **ホバー効果**: 行全体に薄い背景色（`rgba(0, 0, 0, 0.02)`）
- **レスポンシブ**: モバイルデバイスでの表示最適化

## 2. 配信検索タブ

### 機能概要

キーワードおよびシリーズフィルターによる配信検索機能。

### フォーム構成

#### 検索フィールド

- **検索キーワード入力**:
  - ラベル: "検索キーワード"
  - プレースホルダー: "タイトルまたは概要で検索"
  - フルウィズ入力フィールド

- **シリーズ選択**:
  - ラベル: "シリーズ"
  - ドロップダウンオプション:
    - "すべて" (デフォルト)
    - "Basic Series"
    - "Guest Series" 
    - "Community Series"

#### 検索ボタン

- **通常状態**: "検索"
- **ローディング状態**: "検索中..." + ボタン無効化
- **スタイル**: プライマリーカラー背景

### 検索結果表示

#### 結果アイテム構造

各検索結果は以下の要素を含む：

- **エピソードタイトル**: 大きめフォント、太字
- **シリーズ名**: 小さめフォント、グレー色
- **エピソード概要**: テキスト表示
  - 背景色: `rgba(0, 0, 0, 0.02)`
  - 左ボーダー: 3px、プライマリーカラー
  - パディング: 1rem
  - 角丸デザイン

#### アクションボタン

- **再生ボタン**:
  - プライマリーカラーのリンクスタイル
  - クリック時に配信URLへ遷移（新しいタブで開く）
  - `target="_blank" rel="noopener noreferrer"` 属性付き

- **コメントボタン**:
  - クリック時に`/?tab=comments&episodeId=${id}`に遷移
  - コメントアイコン（💬）付きスタイル
  - テキスト: "コメントを見る"

#### 状態表示

- **検索結果なし**: 中央配置のメッセージ
- **ローディング**: スピナーアニメーション付きインジケーター

### コンテナスタイル

- **最大幅**: 800px
- **パディング**: 1.5rem
- **背景**: カード背景色
- **シャドウ**: `var(--shadow-md)`
- **境界**: 1px、ボーダーカラー

## 3. コメントタブ

### 機能概要

リスナーコメントの2次元散布図による可視化。X軸は「リアクション ↔ 意見」、Y軸は「ネガティブ ↔ ポジティブ」を表現。

### グラフ仕様

#### 座標系

- **サイズ**: 600x600px（デスクトップ）
- **X軸範囲**: 0-1（リアクション→意見）
- **Y軸範囲**: 0-1（ネガティブ→ポジティブ）
- **軸ラベル**:
  - X軸: "← リアクション | 意見 →"
  - Y軸: "ポジティブ ↑"

#### データポイント（コメントドット）

- **基本サイズ**: 半径8px
- **ホバー時**: 半径10px + ドロップシャドウ
- **選択時**: 半径10px + 太い境界線（3px）

#### シリーズ別カラーリング

- **Basic Series**: `#34d399` (緑)
- **Guest Series**: `#60a5fa` (青)  
- **Community Series**: `#f472b6` (ピンク)

### インタラクション機能

#### マウスインタラクション

- **ホバー**: 
  - ドットサイズ拡大
  - ツールチップ表示
  - ドロップシャドウ効果

- **クリック**:
  - ドット選択状態
  - 詳細ツールチップ表示（固定）
  - フィードバックボタン表示

#### ツールチップ表示

##### 基本ツールチップ（ホバー時）

- **幅**: 250px
- **背景**: カード背景色
- **ボーダー**: 1px、ボーダーカラー
- **内容**: 
  - エピソード番号
  - コメントテキスト
  - 投稿者名

##### 詳細ツールチップ（クリック時）

上記に加えて：

- **フィードバックボタン群**:
  - "👍 役に立つ"
  - "❤️ 共感できる"  
  - "🎯 的を射ている"
- **ボーダー**: 2px、プライマリーカラー
- **シャドウ**: 拡張シャドウ + カラーグロー

#### ツールチップ位置調整

画面端での自動位置調整：
- 右端: 左側表示
- 左端: 右側表示  
- 上端: 下側表示
- 下端: 上側表示
- 角部: 対角表示

### エピソード選択

- **ドロップダウン選択**: エピソード切り替え機能
- **データ保持**: エピソード切り替え時にデータフラッシュ防止
  - コンポーネントに安定した `key` 属性を使用（`key="comments-section"`）
  - Shallow ルーティングでの画面遷移

### 凡例表示

#### 全エピソード表示時

各シリーズの色分け説明：
- カラーボックス（16x16px）+ シリーズ名
- 水平配置、適切な間隔

#### 特定エピソード表示時

選択されたエピソードの情報のみ表示

### レスポンシブ対応

#### モバイル表示（画面幅700px以下）

- **グラフサイズ**: 450x450px
- **スケール**: 0.75倍
- **ツールチップ幅**: 200px
- **フォントサイズ**: 0.9rem

## ローディング状態

### 全体的なローディングUI

- **インジケーター**: 
  - サイズ: 40x40px
  - アニメーション: 回転（1秒周期）
  - カラー: プライマリーカラー
- **テキスト**: 各セクションに応じたメッセージ
  - 配信一覧: "配信データを読み込み中..."
  - コメント: "コメントを読み込んでいます..."
  - 検索: "検索中..."

## URLルーティング

### パラメーター仕様

- **タブ切り替え**: `/?tab={tabId}`
  - `tab=broadcasts`: 配信一覧タブ
  - `tab=search`: 検索タブ  
  - `tab=comments`: コメントタブ

- **エピソード指定**: `/?tab=comments&episodeId={id}`
  - 特定エピソードのコメント表示

### ナビゲーション動作

- **Shallow routing**: ページリロードなしでURL更新
  - `router.replace()` を使用してブラウザ履歴の不要なエントリを防止
- **ブラウザ履歴**: 戻る/進むボタン対応

## データ構造

### 配信データ

```typescript
interface PastBroadcast {
  id: number;
  date: string;      // YYYY-MM-DD形式
  title: string;     // エピソードタイトル
  excerpt: string;   // 概要テキスト
  series: string;    // シリーズ名
  duration: string;  // MM:SS形式
  url: string;       // 配信URL
}
```

### コメントデータ

```typescript
interface Comment {
  id: number;
  episodeId: number;
  text: string;       // コメント本文
  user: string;       // ユーザー名
  opinionValue: number;  // 0-1の値（意見度合い）
  sentimentValue: number; // 0-1の値（感情度合い）
}
```

## 技術仕様

### 使用技術

- **フレームワーク**: Next.js 14
- **言語**: TypeScript
- **スタイリング**: CSS Modules
- **レスポンシブ**: CSS Media Queries
- **状態管理**: React Hooks (`useState`, `useEffect`)

### API構造

- **/api/broadcasts**: 配信データ一覧を返却
- **/api/search-broadcasts**: キーワードとシリーズによる検索
- **/api/comments**: エピソードIDに基づくコメント取得

### パフォーマンス

- **静的生成**: 可能な部分は事前生成
- **コードスプリッティング**: 自動最適化
- **画像最適化**: Next.js標準機能
- **データキャッシング**: 適切なキャッシュ戦略

## アクセシビリティ

### 基本対応

- **キーボードナビゲーション**: Tab順序の最適化
- **セマンティックHTML**: 適切なHTML要素使用
- **カラーコントラスト**: WCAG準拠
- **スクリーンリーダー**: ラベル・説明文の適切な配置

### インタラクション対応

- **フォーカス表示**: 明確なフォーカスインジケーター
- **エラーメッセージ**: 明確な警告・エラー表示
- **ローディング状態**: 適切な状態表示と読み込み通知

---

*最終更新: 2025年5月*